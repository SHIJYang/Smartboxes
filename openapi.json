{
  "openapi": "3.0.1",
  "info": {
    "title": "智能收纳盒系统 API 文档",
    "description": "智能收纳盒系统的RESTful API接口文档",
    "version": "v1.0.0",
    "contact": {
      "name": "14577"
    },
    "license": {
      "name": "Apache 2.0",
      "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8080",
      "description": "本地开发服务器"
    }
  ],
  "paths": {
    "/api/boxes/add": {
      "post": {
        "tags": ["盒子管理"],
        "summary": "新增盒子",
        "operationId": "addBox",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BoxDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/boxes/delete/{id}": {
      "delete": {
        "tags": ["盒子管理"],
        "summary": "删除盒子",
        "operationId": "deleteBox",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/boxes/update": {
      "put": {
        "tags": ["盒子管理"],
        "summary": "修改盒子",
        "operationId": "updateBox",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BoxDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/boxes/list": {
      "get": {
        "tags": ["盒子管理"],
        "summary": "查询盒子列表",
        "operationId": "listBoxes",
        "parameters": [
          {
            "name": "userId",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "boxCode",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "boxName",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "boxType",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32"
            }
          },
          {
            "name": "status",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultBoxDTOList"
                }
              }
            }
          }
        }
      }
    },
    "/api/items/add": {
      "post": {
        "tags": ["商品管理"],
        "summary": "添加新商品",
        "description": "创建新的商品记录",
        "operationId": "addItem",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ItemDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/items/delete/{id}": {
      "delete": {
        "tags": ["商品管理"],
        "summary": "删除商品",
        "description": "删除指定的商品记录",
        "operationId": "deleteItem",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/items/update": {
      "put": {
        "tags": ["商品管理"],
        "summary": "更新商品信息",
        "description": "更新商品的基本信息",
        "operationId": "updateItem",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ItemDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/items/list": {
      "get": {
        "tags": ["商品管理"],
        "summary": "查询商品列表",
        "description": "根据条件查询商品列表",
        "operationId": "listItems",
        "parameters": [
          {
            "name": "boxId",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "itemCode",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "itemTag",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "isValid",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultItemDTOList"
                }
              }
            }
          }
        }
      }
    },
    "/api/users": {
      "post": {
        "tags": ["用户管理"],
        "summary": "创建用户",
        "description": "创建新的用户账户",
        "operationId": "createUser",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserDO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserDTO"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": ["用户管理"],
        "summary": "获取所有用户",
        "description": "获取系统中所有用户列表",
        "operationId": "getAllUsers",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/UserDTO"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users/{id}": {
      "get": {
        "tags": ["用户管理"],
        "summary": "根据ID获取用户",
        "description": "根据用户ID获取用户详细信息",
        "operationId": "getUserById",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserDTO"
                }
              }
            }
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "put": {
        "tags": ["用户管理"],
        "summary": "更新用户",
        "description": "更新用户基本信息",
        "operationId": "updateUser",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserDO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserDTO"
                }
              }
            }
          },
          "404": {
            "description": "Not Found"
          }
        }
      },
      "delete": {
        "tags": ["用户管理"],
        "summary": "删除用户",
        "description": "删除指定的用户账户",
        "operationId": "deleteUser",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "No Content"
          }
        }
      }
    },
    "/api/users/page": {
      "get": {
        "tags": ["用户管理"],
        "summary": "分页查询用户",
        "description": "分页查询用户信息",
        "operationId": "getUsersByPage",
        "parameters": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/UserDTO"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/emotions/add": {
      "post": {
        "tags": ["情感标签管理"],
        "summary": "添加情感标签",
        "description": "为物品添加情感标签",
        "operationId": "addEmotion",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EmotionDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/emotions/delete/{id}": {
      "delete": {
        "tags": ["情感标签管理"],
        "summary": "删除情感标签",
        "description": "删除指定的情感标签",
        "operationId": "deleteEmotion",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/emotions/update": {
      "put": {
        "tags": ["情感标签管理"],
        "summary": "更新情感标签",
        "description": "更新情感标签信息",
        "operationId": "updateEmotion",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EmotionDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/emotions/list": {
      "get": {
        "tags": ["情感标签管理"],
        "summary": "查询情感标签列表",
        "description": "根据条件查询情感标签列表",
        "operationId": "listEmotions",
        "parameters": [
          {
            "name": "itemId",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultEmotionDTOList"
                }
              }
            }
          }
        }
      }
    },
    "/api/chat": {
      "post": {
        "tags": ["AI聊天"],
        "summary": "AI聊天",
        "description": "处理用户的AI聊天请求",
        "operationId": "chat",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AiChatRequestDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultObject"
                }
              }
            }
          }
        }
      }
    },
    "/api/error-recovery/record-error": {
      "post": {
        "tags": ["错误修复管理"],
        "summary": "记录运行时错误",
        "description": "记录系统运行时错误日志",
        "operationId": "recordRuntimeError",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ErrorLogDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultVoid"
                }
              }
            }
          }
        }
      }
    },
    "/api/error-recovery/trigger-fallback": {
      "post": {
        "tags": ["错误修复管理"],
        "summary": "触发优雅降级策略",
        "description": "在服务异常时触发降级策略",
        "operationId": "triggerGracefulFallback",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FallbackRequestDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestResultObject"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "BoxDTO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "主键ID"
          },
          "boxCode": {
            "type": "string",
            "description": "盒子编码",
            "maxLength": 32
          },
          "userId": {
            "type": "integer",
            "format": "int64",
            "description": "用户ID"
          },
          "boxName": {
            "type": "string",
            "description": "盒子名称",
            "maxLength": 50
          },
          "boxType": {
            "type": "integer",
            "format": "int32",
            "description": "箱体类型 0-子箱，1-主箱",
            "minimum": 0,
            "maximum": 1
          },
          "status": {
            "type": "integer",
            "format": "int32",
            "description": "盒子状态（0-离线 1-在线 2-低电 3-故障）",
            "minimum": 0,
            "maximum": 3
          },
          "rssi": {
            "type": "integer",
            "format": "int32",
            "description": "RSSI信号强度（-100到0）",
            "minimum": -100,
            "maximum": 0
          },
          "battery": {
            "type": "integer",
            "format": "int32",
            "description": "电池电量（0-100）",
            "minimum": 0,
            "maximum": 100
          },
          "lastHeartbeatTime": {
            "type": "string",
            "format": "date-time",
            "description": "最后心跳时间"
          },
          "createTime": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updateTime": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        },
        "required": ["boxCode", "userId", "boxName", "boxType", "status"]
      },
      "ItemDTO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "主键ID"
          },
          "itemCode": {
            "type": "string",
            "description": "商品编码",
            "maxLength": 255
          },
          "itemName": {
            "type": "string",
            "description": "商品名称",
            "maxLength": 100
          },
          "itemDesc": {
            "type": "string",
            "description": "商品描述 - 对应数据库的 item_desc 字段",
            "maxLength": 500
          },
          "boxId": {
            "type": "integer",
            "format": "int64",
            "description": "盒子ID"
          },
          "price": {
            "type": "number",
            "format": "double",
            "description": "商品价格"
          },
          "autoRecognizeName": {
            "type": "string",
            "description": "自动识别名称"
          },
          "manualEditName": {
            "type": "string",
            "description": "手动编辑名称"
          },
          "itemTag": {
            "type": "string",
            "description": "商品标签"
          },
          "putInTime": {
            "type": "string",
            "format": "date-time",
            "description": "放入时间"
          },
          "expireTime": {
            "type": "string",
            "format": "date-time",
            "description": "过期时间"
          },
          "isValid": {
            "type": "integer",
            "format": "int32",
            "description": "是否有效"
          },
          "createTime": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updateTime": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        },
        "required": ["itemCode", "itemName", "boxId", "price"]
      },
      "EmotionDTO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "主键ID"
          },
          "itemId": {
            "type": "integer",
            "format": "int64",
            "description": "物品ID（必填）"
          },
          "emotionTag": {
            "type": "integer",
            "format": "int32",
            "description": "情感标签（必填）1-快乐 2-悲伤 3-愤怒 4-焦虑 5-平静"
          },
          "emotionRemark": {
            "type": "string",
            "description": "情感备注",
            "maxLength": 500
          }
        },
        "required": ["itemId", "emotionTag"]
      },
      "UserDTO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "主键ID"
          },
          "username": {
            "type": "string",
            "description": "用户名"
          },
          "email": {
            "type": "string",
            "description": "邮箱"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "UserDO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "主键ID"
          },
          "username": {
            "type": "string",
            "description": "用户名"
          },
          "email": {
            "type": "string",
            "description": "邮箱"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        }
      },
      "AiChatRequestDTO": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "integer",
            "format": "int64",
            "description": "用户ID"
          },
          "message": {
            "type": "string",
            "description": "用户发送的消息内容",
            "maxLength": 1000
          }
        },
        "required": ["userId", "message"]
      },
      "ErrorLogDTO": {
        "type": "object",
        "properties": {
          "errorCode": {
            "type": "string",
            "description": "错误编码"
          },
          "errorMessage": {
            "type": "string",
            "description": "错误信息"
          },
          "errorTime": {
            "type": "string",
            "format": "date-time",
            "description": "错误时间"
          }
        },
        "required": ["errorCode", "errorMessage", "errorTime"]
      },
      "FallbackRequestDTO": {
        "type": "object",
        "properties": {
          "serviceId": {
            "type": "string",
            "description": "服务标识"
          },
          "fallbackReason": {
            "type": "string",
            "description": "降级原因"
          }
        },
        "required": ["serviceId", "fallbackReason"]
      },
      "RestResultVoid": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "object",
            "description": "Void类型，通常为空"
          }
        }
      },
      "RestResultBoxDTOList": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BoxDTO"
            }
          }
        }
      },
      "RestResultItemDTOList": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ItemDTO"
            }
          }
        }
      },
      "RestResultEmotionDTOList": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EmotionDTO"
            }
          }
        }
      },
      "RestResultObject": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "object"
          }
        }
      }
    }
  }
}